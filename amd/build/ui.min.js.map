{"version":3,"file":"ui.min.js","sources":["../src/ui.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Tiny Panopto LTI Video ui helper.\r\n *\r\n * @module     tiny_panoptoltibutton/ui\r\n * @copyright  2023 Panopto\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport Modal from 'tiny_panoptoltibutton/modal';\r\nimport ModalFactory from 'core/modal_factory';\r\nimport\r\n    {\r\n        getCourseId,\r\n        getWwwroot,\r\n        getContentItemPath,\r\n        getResourceBase,\r\n        getTool,\r\n        getUnprovisionedError\r\n    } from './options';\r\nimport Config from 'core/config';\r\n\r\nexport const handleAction = (editor) => {\r\n    displayDialogue(editor);\r\n};\r\n\r\n/**\r\n * Get the template context for the dialogue.\r\n *\r\n * @param {Editor} editor\r\n * @param {object} data\r\n * @returns {object} data\r\n */\r\nconst getTemplateContext = (editor, data) => {\r\n    const baseUrl = `${Config.wwwroot}/lib/editor/tiny/plugins/panoptoltibutton/panoptowrapper.html#`;\r\n    const unprovisionedError = encodeURIComponent(\r\n        getUnprovisionedError(editor)\r\n    );\r\n    const courseId = getCourseId(editor);\r\n    const tool = encodeURIComponent(JSON.stringify(getTool(editor)));\r\n    const resourceBase = getResourceBase(editor);\r\n    const wwwroot = encodeURIComponent(getWwwroot(editor));\r\n    const contentItemPath = encodeURIComponent(getContentItemPath(editor));\r\n\r\n    const fullUrl =\r\n        baseUrl +\r\n        `unprovisionerror=${unprovisionedError}` +\r\n        `&courseid=${courseId}` +\r\n        `&tool=${tool}` +\r\n        `&resourcebase=${resourceBase}` +\r\n        `&wwwroot=${wwwroot}` +\r\n        `&contentitempath=${contentItemPath}`;\r\n\r\n    return Object.assign({}, {\r\n        iframe: fullUrl.toString(),\r\n    }, data);\r\n};\r\n\r\nconst displayDialogue = async (editor, data = {}) => {\r\n    editor.focus(true);\r\n    const modal = await ModalFactory.create({\r\n        type: Modal.TYPE,\r\n        templateContext: getTemplateContext(editor, data),\r\n        large: true,\r\n        scrollable: false,\r\n    });\r\n\r\n    const $root = await modal.getRoot();\r\n\r\n    // Get the iframe element inside the modal.\r\n    let iframe = $root.find(\"iframe\");\r\n\r\n    // Make the iframe responsive by setting its width and height to 100%.\r\n    iframe.css({\r\n        width: \"100%\",\r\n        height: \"100%\",\r\n        border: \"none\",\r\n    });\r\n\r\n    // Set the maximum width for the modal content container.\r\n    let contentContainer = $root.find(\".modal-dialog\");\r\n    contentContainer.css({\r\n        \"max-width\": \"55vw\",\r\n    });\r\n\r\n    // Set height for the body container.\r\n    let bodyContainer = $root.find(\".modal-body\");\r\n    bodyContainer.css({\r\n        height: \"81vh\",\r\n    });\r\n\r\n    modal.show();\r\n\r\n    // Close modal from iframe.\r\n    window.closeModal = () => {\r\n        const closeButton = document.querySelector(\"#panopto-close\");\r\n        if (closeButton) {\r\n            closeButton.click();\r\n        }\r\n    };\r\n};\r\n"],"names":["editor","displayDialogue","getTemplateContext","data","baseUrl","Config","wwwroot","unprovisionedError","encodeURIComponent","courseId","tool","JSON","stringify","resourceBase","contentItemPath","fullUrl","Object","assign","iframe","toString","async","focus","modal","ModalFactory","create","type","Modal","TYPE","templateContext","large","scrollable","$root","getRoot","find","css","width","height","border","contentContainer","bodyContainer","show","window","closeModal","closeButton","document","querySelector","click"],"mappings":";;;;;;;oPAoC6BA,SACzBC,gBAAgBD,eAUdE,mBAAqB,CAACF,OAAQG,cAC1BC,kBAAaC,gBAAOC,0EACpBC,mBAAqBC,oBACvB,kCAAsBR,SAEpBS,UAAW,wBAAYT,QACvBU,KAAOF,mBAAmBG,KAAKC,WAAU,oBAAQZ,UACjDa,cAAe,4BAAgBb,QAC/BM,QAAUE,oBAAmB,uBAAWR,SACxCc,gBAAkBN,oBAAmB,+BAAmBR,SAExDe,QACFX,mCACoBG,wCACPE,0BACJC,8BACQG,iCACLP,oCACQQ,wBAEjBE,OAAOC,OAAO,GAAI,CACrBC,OAAQH,QAAQI,YACjBhB,OAGDF,gBAAkBmB,eAAOpB,YAAQG,4DAAO,GAC1CH,OAAOqB,OAAM,SACPC,YAAcC,uBAAaC,OAAO,CACpCC,KAAMC,eAAMC,KACZC,gBAAiB1B,mBAAmBF,OAAQG,MAC5C0B,OAAO,EACPC,YAAY,IAGVC,YAAcT,MAAMU,cAGtBd,OAASa,MAAME,KAAK,UAGxBf,OAAOgB,IAAI,CACPC,MAAO,OACPC,OAAQ,OACRC,OAAQ,aAIRC,iBAAmBP,MAAME,KAAK,iBAClCK,iBAAiBJ,IAAI,aACJ,aAIbK,cAAgBR,MAAME,KAAK,eAC/BM,cAAcL,IAAI,CACdE,OAAQ,SAGZd,MAAMkB,OAGNC,OAAOC,WAAa,WACVC,YAAcC,SAASC,cAAc,kBACvCF,aACAA,YAAYG"}