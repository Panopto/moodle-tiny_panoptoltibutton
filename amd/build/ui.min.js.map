{"version":3,"file":"ui.min.js","sources":["../src/ui.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tiny Panopto LTI Video ui helper.\n *\n * @module     tiny_panoptoltibutton/ui\n * @copyright  2023 Panopto\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Modal from 'tiny_panoptoltibutton/modal';\nimport ModalFactory from 'core/modal_factory';\nimport\n    {\n        getCourseId,\n        getWwwroot,\n        getContentItemPath,\n        getResourceBase,\n        getTool,\n        getUnprovisionedError\n    } from './options';\nimport Config from 'core/config';\n\nexport const handleAction = (editor) => {\n    displayDialogue(editor);\n};\n\n/**\n * Get the template context for the dialogue.\n *\n * @param {Editor} editor\n * @param {object} data\n * @returns {object} data\n */\nconst getTemplateContext = (editor, data) => {\n    const baseUrl = `${Config.wwwroot}/lib/editor/tiny/plugins/panoptoltibutton/panoptowrapper.html#`;\n    const unprovisionedError = encodeURIComponent(\n        getUnprovisionedError(editor)\n    );\n    const courseId = getCourseId(editor);\n    const tool = encodeURIComponent(JSON.stringify(getTool(editor)));\n    const resourceBase = getResourceBase(editor);\n    const wwwroot = encodeURIComponent(getWwwroot(editor));\n    const contentItemPath = encodeURIComponent(getContentItemPath(editor));\n\n    const fullUrl =\n        baseUrl +\n        `unprovisionerror=${unprovisionedError}` +\n        `&courseid=${courseId}` +\n        `&tool=${tool}` +\n        `&resourcebase=${resourceBase}` +\n        `&wwwroot=${wwwroot}` +\n        `&contentitempath=${contentItemPath}`;\n\n    return Object.assign({}, {\n        iframe: fullUrl.toString(),\n    }, data);\n};\n\nconst displayDialogue = async(editor, data = {}) => {\n    editor.focus(true);\n    const modal = await ModalFactory.create({\n        type: Modal.TYPE,\n        templateContext: getTemplateContext(editor, data),\n        large: true,\n        scrollable: false,\n    });\n\n    const $root = await modal.getRoot();\n\n    // Get the iframe element inside the modal.\n    let iframe = $root.find(\"iframe\");\n\n    // Make the iframe responsive by setting its width and height to 100%.\n    iframe.css({\n        width: \"100%\",\n        height: \"100%\",\n        border: \"none\",\n    });\n\n    // Set the maximum width for the modal content container.\n    let contentContainer = $root.find(\".modal-dialog\");\n    contentContainer.css({\n        \"max-width\": \"55vw\",\n    });\n\n    // Set height for the body container.\n    let bodyContainer = $root.find(\".modal-body\");\n    bodyContainer.css({\n        height: \"81vh\",\n    });\n\n    modal.show();\n\n    // Close modal from iframe.\n    window.closeModal = () => {\n        const closeButton = document.querySelector(\"#panopto-close\");\n        if (closeButton) {\n            closeButton.click();\n        }\n    };\n};\n"],"names":["editor","displayDialogue","getTemplateContext","data","baseUrl","Config","wwwroot","unprovisionedError","encodeURIComponent","courseId","tool","JSON","stringify","resourceBase","contentItemPath","fullUrl","Object","assign","iframe","toString","async","focus","modal","ModalFactory","create","type","Modal","TYPE","templateContext","large","scrollable","$root","getRoot","find","css","width","height","border","contentContainer","bodyContainer","show","window","closeModal","closeButton","document","querySelector","click"],"mappings":";;;;;;;oPAoC6BA,SACzBC,gBAAgBD,eAUdE,mBAAqB,CAACF,OAAQG,cAC1BC,kBAAaC,gBAAOC,0EACpBC,mBAAqBC,oBACvB,kCAAsBR,SAEpBS,UAAW,wBAAYT,QACvBU,KAAOF,mBAAmBG,KAAKC,WAAU,oBAAQZ,UACjDa,cAAe,4BAAgBb,QAC/BM,QAAUE,oBAAmB,uBAAWR,SACxCc,gBAAkBN,oBAAmB,+BAAmBR,SAExDe,QACFX,mCACoBG,wCACPE,0BACJC,8BACQG,iCACLP,oCACQQ,wBAEjBE,OAAOC,OAAO,GAAI,CACrBC,OAAQH,QAAQI,YACjBhB,OAGDF,gBAAkBmB,eAAMpB,YAAQG,4DAAO,GACzCH,OAAOqB,OAAM,SACPC,YAAcC,uBAAaC,OAAO,CACpCC,KAAMC,eAAMC,KACZC,gBAAiB1B,mBAAmBF,OAAQG,MAC5C0B,OAAO,EACPC,YAAY,IAGVC,YAAcT,MAAMU,cAGtBd,OAASa,MAAME,KAAK,UAGxBf,OAAOgB,IAAI,CACPC,MAAO,OACPC,OAAQ,OACRC,OAAQ,aAIRC,iBAAmBP,MAAME,KAAK,iBAClCK,iBAAiBJ,IAAI,aACJ,aAIbK,cAAgBR,MAAME,KAAK,eAC/BM,cAAcL,IAAI,CACdE,OAAQ,SAGZd,MAAMkB,OAGNC,OAAOC,WAAa,WACVC,YAAcC,SAASC,cAAc,kBACvCF,aACAA,YAAYG"}